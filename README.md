# WB-Service

ะะตะผะพะฝัััะฐัะธะพะฝะฝัะน ะผะธะบัะพัะตัะฒะธั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Kafka, PostgreSQL ะธ in-memory ะบััะฐ.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฑะทะพั](#ะพะฑะทะพั)
- [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
- [ะขะตัะฝะพะปะพะณะธะธ](#ัะตัะฝะพะปะพะณะธะธ)
- [ะขัะตะฑะพะฒะฐะฝะธั](#ััะตะฑะพะฒะฐะฝะธั)
- [ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ](#ัััะฐะฝะพะฒะบะฐ-ะธ-ะทะฐะฟััะบ)
- [ะะพะฝัะธะณััะฐัะธั](#ะบะพะฝัะธะณััะฐัะธั)
- [API Endpoints](#api-endpoints)
- [ะขะตััะธัะพะฒะฐะฝะธะต](#ัะตััะธัะพะฒะฐะฝะธะต)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ](#ะพัะพะฑะตะฝะฝะพััะธ-ัะตะฐะปะธะทะฐัะธะธ)
- [ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั](#ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั)
- [ะะฐะทะฒะตัััะฒะฐะฝะธะต](#ัะฐะทะฒะตัััะฒะฐะฝะธะต)
- [ะะธัะตะฝะทะธั](#ะปะธัะตะฝะทะธั)

## ๐ฏ ะะฑะทะพั

WB-Service - ััะพ ะผะธะบัะพัะตัะฒะธั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ ะฒ ัะตะถะธะผะต ัะตะฐะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ. ะกะตัะฒะธั ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะพ ะทะฐะบะฐะทะฐั ะธะท Kafka, ัะพััะฐะฝัะตั ะธั ะฒ PostgreSQL, ะบััะธััะตั ะฒ ะฟะฐะผััะธ ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ ะธ ะฟัะตะดะพััะฐะฒะปัะตั REST API ะดะปั ะฟะพะปััะตะฝะธั ะธะฝัะพัะผะฐัะธะธ ะพ ะทะฐะบะฐะทะฐั.

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- โ ะะพััะตะฑะปะตะฝะธะต ัะพะพะฑัะตะฝะธะน ะธะท Kafka ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- โ ะะฐะปะธะดะฐัะธั ะฒัะพะดััะธั ะดะฐะฝะฝัั ะฟะตัะตะด ัะพััะฐะฝะตะฝะธะตะผ
- โ ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะฒ PostgreSQL ั ะฟะพะดะดะตัะถะบะพะน ัะฒัะทะตะน (delivery, payment, items)
- โ LRU ะบัั ั TTL ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ
- โ REST API ะดะปั ะฟะพะปััะตะฝะธั ะทะฐะบะฐะทะพะฒ ะฟะพ UID
- โ ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะบััะฐ ะธะท ะะ ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต
- โ Graceful shutdown ะดะปั ะบะพััะตะบัะฝะพะณะพ ะทะฐะฒะตััะตะฝะธั ัะฐะฑะพัั
- โ ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ
- โ ะะตะฝะตัะฐัะพั ัะตััะพะฒัั ะดะฐะฝะฝัั
- โ ะะพะบัััะธะต ัะตััะฐะผะธ 80%+

## ๐๏ธ ะััะธัะตะบัััะฐ

### ะะธะฐะณัะฐะผะผะฐ ะบะพะผะฟะพะฝะตะฝัะพะฒ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                            WB-Service                                   โ
โ                                                                         โ
โ  โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ           โ
โ  โ  HTTP Server โ     โ Kafka        โ     โ  Database    โ           โ
โ  โ  (Gin)       โ     โ  Consumer    โ     โ  Layer       โ           โ
โ  โ              โ     โ              โ     โ  (GORM)      โ           โ
โ  โ  - REST API  โ     โ  - Subscribe โ     โ              โ           โ
โ  โ  - Health    โ     โ  - Validate  โ     โ  - Create    โ           โ
โ  โ  - Web UI    โ     โ  - Process   โ     โ  - Read      โ           โ
โ  โโโโโโโโฌโโโโโโโโ     โโโโโโโโฌโโโโโโโโ     โโโโโโโโฌโโโโโโโโ           โ
โ         โ                    โ                    โ                   โ
โ         โ                    โ                    โ                   โ
โ         โโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโค                   โ
โ         โ                                         โ                   โ
โ         โผ                                         โผ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ          LRU Cache (In-Memory)                     โ               โ
โ  โ  - TTL Support                                     โ               โ
โ  โ  - Auto Eviction                                   โ               โ
โ  โ  - Thread-Safe                                     โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ                                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โฒ                    โฒ                    โฒ
           โ                    โ                    โ
           โ                    โ                    โ
    โโโโโโโโดโโโโโโโ     โโโโโโโโโดโโโโโโโโโ   โโโโโโโโดโโโโโโโ
    โ HTTP Client โ     โ Kafka Topic    โ   โ PostgreSQL  โ
    โ             โ     โ "orders"       โ   โ Database    โ
    โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ
                               โฒ
                               โ
                        โโโโโโโโดโโโโโโโ
                        โ Data        โ
                        โ Generator   โ
                        โโโโโโโโโโโโโโโ
```

### ะะพัะพะบ ะดะฐะฝะฝัั

#### 1. ะะฑัะฐะฑะพัะบะฐ ะฒัะพะดััะธั ะทะฐะบะฐะทะพะฒ (Kafka โ DB โ Cache)

```
Kafka Message โ Consumer.ReadMessage()
                     โ
              JSON.Unmarshal()
                     โ
              Validator.Validate()
                     โ (valid)
              Database.Create()
                     โ (success)
              Cache.Set()
                     โ
              Kafka.Commit()
```

#### 2. ะะฑัะฐะฑะพัะบะฐ HTTP ะทะฐะฟัะพัะพะฒ (Cache-Aside Pattern)

```
HTTP GET /order/{uid}
         โ
    Cache.Get(uid)
         โ
    โโโโโโดโโโโโ
    โ  Hit?   โ
    โโโโโโฌโโโโโ
         โ
    โโโโโโดโโโโโโโโโโโโโ
    โผ                 โผ
  (Yes)              (No)
    โ                 โ
    โ            DB.GetOrder(uid)
    โ                 โ
    โ            Cache.Set(uid, order)
    โ                 โ
    โโโโโโโโโโฌโโโโโโโโโ
             โผ
       Return JSON
```

#### 3. Graceful Shutdown

```
SIGINT/SIGTERM
      โ
Cancel Context
      โ
   โโโโดโโโโโโโโโโโโโโโโ
   โผ                  โผ
Kafka Consumer    HTTP Server
stops reading     waits for
                  active requests
   โ                  โ
   โ                  โผ
   โ            Shutdown (30s timeout)
   โ                  โ
   โโโโโโโโฌโโโโโโโโโโโโ
          โผ
    Close DB Connections
          โ
    Exit Clean
```

## ๐๏ธ ะขะตัะฝะพะปะพะณะธะธ

### Backend
- **Go 1.23+** - ะพัะฝะพะฒะฝะพะน ัะทัะบ ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธั
- **Gin** - HTTP ะฒะตะฑ-ััะตะนะผะฒะพัะบ ะดะปั REST API
- **GORM** - ORM ะดะปั ัะฐะฑะพัั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
- **segmentio/kafka-go** - ะบะปะธะตะฝั ะดะปั Apache Kafka

### ะะฝััะฐััััะบัััะฐ
- **PostgreSQL 13** - ัะตะปััะธะพะฝะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **Apache Kafka** - ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน ะดะปั event streaming
- **Zookeeper** - ะบะพะพัะดะธะฝะฐัะธั Kafka ะบะปะฐััะตัะฐ
- **Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ะธะฝััะฐััััะบัััั

### ะะฝััััะผะตะฝัั ัะฐะทัะฐะฑะพัะบะธ
- **Docker** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **Make** - ะฐะฒัะพะผะฐัะธะทะฐัะธั ัะฑะพัะบะธ ะธ ัะตััะธัะพะฒะฐะฝะธั
- **golangci-lint** - ะปะธะฝัะตั ะดะปั Go ะบะพะดะฐ
- **goimports** - ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะธ ัะพััะธัะพะฒะบะฐ ะธะผะฟะพััะพะฒ

## ๐ฆ ะขัะตะฑะพะฒะฐะฝะธั

### ะะฑัะทะฐัะตะปัะฝัะต
- Go 1.23 ะธะปะธ ะฒััะต
- Docker 20.10+
- Docker Compose 1.29+
- Make (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฝะพ ัะตะบะพะผะตะฝะดัะตััั)

### ะะปั ัะฐะทัะฐะฑะพัะบะธ
- Git
- golangci-lint (ะดะปั ะปะธะฝัะธะฝะณะฐ)
- goimports (ะดะปั ัะพัะผะฐัะธัะพะฒะฐะฝะธั)

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <repository-url>
cd WB-service
```

### 2. ะะฐะฟััะบ ะธะฝััะฐััััะบัััั

```bash
# ะะฐะฟััะบ PostgreSQL, Kafka ะธ Zookeeper
make docker-up

# ะะปะธ ะฝะฐะฟััะผัั ัะตัะตะท docker-compose
docker-compose up -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะพะฒ
make docker-status
```

ะะฝััะฐััััะบัััะฐ ะฑัะดะตั ะดะพัััะฟะฝะฐ:
- PostgreSQL: `localhost:5434`
- Kafka: `localhost:9092`
- Zookeeper: `localhost:2181`

### 3. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
make deps

# ะะปะธ ะฝะฐะฟััะผัั
go mod download
go mod tidy
```

### 4. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
# ะงะตัะตะท Make
make run

# ะะปะธ ะฝะฐะฟััะผัั
go run main.go
```

ะกะตัะฒะธั ะฑัะดะตั ะดะพัััะฟะตะฝ: `http://localhost:8080`

### 5. ะะตะฝะตัะฐัะธั ัะตััะพะฒัั ะดะฐะฝะฝัั

```bash
# ะกะณะตะฝะตัะธัะพะฒะฐัั 10 ะทะฐะบะฐะทะพะฒ ั ะธะฝัะตัะฒะฐะปะพะผ 1 ัะตะบัะฝะดะฐ
make generate-data

# ะะปะธ ั ะบะฐััะพะผะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ
go run cmd/generator/main.go -count=50 -delay=500ms

# ะัะต ะฟะฐัะฐะผะตััั ะณะตะฝะตัะฐัะพัะฐ
go run cmd/generator/main.go \
  -brokers=localhost:9092 \
  -topic=orders \
  -count=100 \
  -delay=1s
```

### 6. ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

```bash
# Health check
curl http://localhost:8080/health

# ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ (ะฟะพัะปะต ะณะตะฝะตัะฐัะธะธ ะดะฐะฝะฝัั)
curl http://localhost:8080/order/{order_uid}

# ะะปะธ ะพัะบัะพะนัะต ะฒะตะฑ-ะธะฝัะตััะตะนั
open http://localhost:8080
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

ะัะต ะฝะฐัััะพะนะบะธ ะบะพะฝัะธะณััะธัััััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั. ะัะปะธ ะฟะตัะตะผะตะฝะฝะฐั ะฝะต ะทะฐะดะฐะฝะฐ, ะธัะฟะพะปัะทัะตััั ะทะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั.

### ะะฐะทะฐ ะดะฐะฝะฝัั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|----------------------|
| `DB_HOST` | ะฅะพัั PostgreSQL | `127.0.0.1` |
| `DB_PORT` | ะะพัั PostgreSQL | `5434` |
| `DB_USER` | ะะผั ะฟะพะปัะทะพะฒะฐัะตะปั ะะ | `wb_user` |
| `DB_PASSWORD` | ะะฐัะพะปั ะะ | `wb_password` |
| `DB_NAME` | ะะผั ะฑะฐะทั ะดะฐะฝะฝัั | `wb_db` |
| `DB_SSL_MODE` | ะะตะถะธะผ SSL | `disable` |

### Kafka

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|----------------------|
| `KAFKA_BROKERS` | ะะดัะตัะฐ ะฑัะพะบะตัะพะฒ Kafka | `localhost:9092` |
| `KAFKA_TOPIC` | ะขะพะฟะธะบ ะดะปั ะทะฐะบะฐะทะพะฒ | `orders` |
| `KAFKA_GROUP_ID` | ID ะณััะฟะฟั ะฟะพััะตะฑะธัะตะปะตะน | `order-group` |
| `KAFKA_MIN_BYTES` | ะะธะฝะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะฑะฐััะฐ | `10000` (10KB) |
| `KAFKA_MAX_BYTES` | ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะฑะฐััะฐ | `10000000` (10MB) |

### HTTP ัะตัะฒะตั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|----------------------|
| `SERVER_HOST` | ะฅะพัั ัะตัะฒะตัะฐ | `""` (ะฒัะต ะธะฝัะตััะตะนัั) |
| `SERVER_PORT` | ะะพัั ัะตัะฒะตัะฐ | `8080` |

### ะัั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|----------------------|
| `CACHE_MAX_SIZE` | ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะบััะฐ | `1000` ัะปะตะผะตะฝัะพะฒ |
| `CACHE_TTL` | ะัะตะผั ะถะธะทะฝะธ ัะปะตะผะตะฝัะฐ | `3600` ัะตะบัะฝะด (1 ัะฐั) |

### ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ

```bash
# .env ัะฐะนะป
export DB_HOST=localhost
export DB_PORT=5432
export DB_USER=myuser
export DB_PASSWORD=mypassword
export DB_NAME=mydb

export KAFKA_BROKERS=kafka1:9092,kafka2:9092
export KAFKA_TOPIC=orders
export KAFKA_GROUP_ID=order-service-group

export SERVER_PORT=8080

export CACHE_MAX_SIZE=2000
export CACHE_TTL=7200

# ะะฐะฟััะบ ั ะบะพะฝัะธะณััะฐัะธะตะน
source .env
go run main.go
```

## ๐ API Endpoints

### GET /order/{order_uid}

ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ ะฟะพ ัะฝะธะบะฐะปัะฝะพะผั ะธะดะตะฝัะธัะธะบะฐัะพัั.

**ะะฐัะฐะผะตััั:**
- `order_uid` (path) - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะทะฐะบะฐะทะฐ

**ะัะธะผะตั ะทะฐะฟัะพัะฐ:**
```bash
curl http://localhost:8080/order/b563feb7b2b84b6test
```

**ะฃัะฟะตัะฝัะน ะพัะฒะตั (200 OK):**
```json
{
  "order_uid": "b563feb7b2b84b6test",
  "track_number": "WBILMTESTTRACK",
  "entry": "WBIL",
  "delivery": {
    "name": "Test Testov",
    "phone": "+9720000000",
    "zip": "2639809",
    "city": "Kiryat Mozkin",
    "address": "Ploshad Mira 15",
    "region": "Kraiot",
    "email": "test@gmail.com"
  },
  "payment": {
    "transaction": "b563feb7b2b84b6test",
    "request_id": "",
    "currency": "USD",
    "provider": "wbpay",
    "amount": 1817,
    "payment_dt": 1637907727,
    "bank": "alpha",
    "delivery_cost": 1500,
    "goods_total": 317,
    "custom_fee": 0
  },
  "items": [
    {
      "chrt_id": 9934930,
      "track_number": "WBILMTESTTRACK",
      "price": 453,
      "rid": "ab4219087a764ae0btest",
      "name": "Mascaras",
      "sale": 30,
      "size": "0",
      "total_price": 317,
      "nm_id": 2389232,
      "brand": "Vivienne Sabo",
      "status": 202
    }
  ],
  "locale": "en",
  "internal_signature": "",
  "customer_id": "test",
  "delivery_service": "meest",
  "shardkey": "9",
  "sm_id": 99,
  "date_created": "2021-11-26T06:22:19Z",
  "oof_shard": "1"
}
```

**ะัะธะฑะบะฐ - ะทะฐะบะฐะท ะฝะต ะฝะฐะนะดะตะฝ (404 Not Found):**
```json
{
  "error": "record not found"
}
```

**ะัะธะฑะบะฐ ะฑะฐะทั ะดะฐะฝะฝัั (500 Internal Server Error):**
```json
{
  "error": "database error"
}
```

### GET /health

ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะฐ.

**ะัะธะผะตั ะทะฐะฟัะพัะฐ:**
```bash
curl http://localhost:8080/health
```

**ะัะฒะตั (200 OK):**
```json
{
  "status": "ok"
}
```

### GET /

ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ. ะัะบััะฒะฐะตััั ะฒ ะฑัะฐัะทะตัะต:
```bash
open http://localhost:8080
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะะฐะฟััะบ ัะตััะพะฒ

```bash
# ะัะต ัะตััั
make test

# ะขะตััั ั ะฟะพะบัััะธะตะผ
make test-cover

# ะะพะดัะพะฑะฝัะน ะฒัะฒะพะด + HTML ะพััะตั ะฟะพะบัััะธั
make test-verbose

# ะัะพะฒะตัะบะฐ ะผะธะฝะธะผะฐะปัะฝะพะณะพ ะฟะพะบัััะธั 80%
make test-coverage-check
```

### ะขะตััั ะพัะดะตะปัะฝัั ะฟะฐะบะตัะพะฒ

```bash
make test-models       # ะขะตััั ะผะพะดะตะปะตะน
make test-config       # ะขะตััั ะบะพะฝัะธะณััะฐัะธะธ
make test-cache        # ะขะตััั ะบััะฐ
make test-validator    # ะขะตััั ะฒะฐะปะธะดะฐัะพัะฐ
make test-repository   # ะขะตััั ัะตะฟะพะทะธัะพัะธั
make test-generator    # ะขะตััั ะณะตะฝะตัะฐัะพัะฐ
make test-main         # ะขะตััั HTTP handlers
```

### ะะตะฝัะผะฐัะบะธ ะธ ะฟัะพัะธะปะธัะพะฒะฐะฝะธะต

```bash
# ะะตะฝัะผะฐัะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะบััะฐ
make benchmark

# ะัะพัะธะปะธัะพะฒะฐะฝะธะต CPU
make profile-cpu

# ะัะพัะธะปะธัะพะฒะฐะฝะธะต ะฟะฐะผััะธ
make profile-mem
```

### ะะธะฝัะธะฝะณ

```bash
# ะะฐะฟััะบ ะปะธะฝัะตัะฐ (ััะตะฑัะตั golangci-lint)
make lint
```

### ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั

```bash
# ะะฐะฟััะบ ะธะฝัะตะณัะฐัะธะพะฝะฝัั ัะตััะพะฒ (ััะตะฑัะตั Docker)
make test-integration
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
WB-service/
โโโ cmd/                        # ะัะฟะพะปะฝัะตะผัะต ะฟัะธะปะพะถะตะฝะธั
โ   โโโ generator/             # ะะตะฝะตัะฐัะพั ัะตััะพะฒัั ะดะฐะฝะฝัั
โ       โโโ main.go           # Kafka producer ั fake data
โ       โโโ main_test.go      # ะขะตััั ะณะตะฝะตัะฐัะพัะฐ
โ
โโโ config/                    # ะะพะฝัะธะณััะฐัะธั
โ   โโโ config.go             # ะะฐะณััะทะบะฐ ะฝะฐัััะพะตะบ ะธะท ENV
โ   โโโ config_test.go        # ะขะตััั ะบะพะฝัะธะณััะฐัะธะธ
โ
โโโ database/                  # ะะฐะทะฐ ะดะฐะฝะฝัั
โ   โโโ database.go           # ะะฝะธัะธะฐะปะธะทะฐัะธั GORM
โ   โโโ database_test.go      # ะขะตััั ะฟะพะดะบะปััะตะฝะธั ะบ ะะ
โ
โโโ internal/                  # ะะฝัััะตะฝะฝะธะต ะฟะฐะบะตัั
โ   โโโ cache/                # LRU ะบัั ั TTL
โ   โ   โโโ lru_cache.go
โ   โ   โโโ lru_cache_test.go
โ   โ
โ   โโโ interfaces/           # ะะฝัะตััะตะนัั ะดะปั DI
โ   โ   โโโ interfaces.go
โ   โ
โ   โโโ repository/           # ะกะปะพะน ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ
โ   โ   โโโ database.go
โ   โ   โโโ database_test.go
โ   โ
โ   โโโ validator/            # ะะฐะปะธะดะฐัะธั ะฑะธะทะฝะตั-ะฟัะฐะฒะธะป
โ       โโโ order_validator.go
โ       โโโ order_validator_test.go
โ
โโโ kafka/                     # Kafka consumer
โ   โโโ consumer.go           # ะะฑัะฐะฑะพัะบะฐ ัะพะพะฑัะตะฝะธะน
โ   โโโ consumer_test.go      # ะขะตััั consumer
โ
โโโ models/                    # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ models.go             # GORM ะผะพะดะตะปะธ (Order, Delivery, Payment, Item)
โ   โโโ models_test.go        # ะขะตััั ะผะพะดะตะปะตะน
โ
โโโ producer/                  # Kafka producer (ัััะฐัะตะฒัะธะน)
โ   โโโ producer.go
โ
โโโ web/                       # ะะตะฑ-ะธะฝัะตััะตะนั
โ   โโโ index.html            # HTML ัััะฐะฝะธัะฐ ะดะปั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ
โ
โโโ docker-compose.yml         # ะะฝััะฐััััะบัััะฐ (Kafka, PostgreSQL)
โโโ schema.sql                 # SQL ััะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั
โโโ Makefile                   # ะะพะผะฐะฝะดั ะดะปั ัะฑะพัะบะธ ะธ ัะตััะธัะพะฒะฐะฝะธั
โโโ go.mod                     # Go ะผะพะดัะปั ะธ ะทะฐะฒะธัะธะผะพััะธ
โโโ go.sum                     # ะฅะตัะธ ะทะฐะฒะธัะธะผะพััะตะน
โโโ main.go                    # ะขะพัะบะฐ ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั
โโโ main_test.go              # ะขะตััั HTTP handlers
โโโ  README.md                  # ะะพะบัะผะตะฝัะฐัะธั (ััะพั ัะฐะนะป)

```

## โก ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ

### 1. LRU Cache ั TTL

ะะตะฐะปะธะทะพะฒะฐะฝ ะบัั ะฝะฐ ะพัะฝะพะฒะต ะดะฒัั ััััะบััั ะดะฐะฝะฝัั:
- **HashMap** ะดะปั O(1) ะฟะพะธัะบะฐ
- **Doubly Linked List** ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะฟะพััะดะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**ะะพะทะผะพะถะฝะพััะธ:**
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะดะฐะปะตะฝะธะต ะฝะฐะธะผะตะฝะตะต ะธัะฟะพะปัะทัะตะผัั ัะปะตะผะตะฝัะพะฒ
- TTL (Time To Live) ั ัะพะฝะพะฒะพะน ะพัะธััะบะพะน ัััะฐัะตะฒัะธั ัะปะตะผะตะฝัะพะฒ
- Thread-safe ะพะฟะตัะฐัะธะธ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ `sync.RWMutex`
- Warm-up ะธะท ะะ ะฟัะธ ััะฐััะต

**ะะพะด:** `internal/cache/lru_cache.go`

### 2. Graceful Shutdown

ะะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ัะฐะฑะพัั ะฟัะธ ะฟะพะปััะตะฝะธะธ SIGINT/SIGTERM:
1. ะััะฐะฝะพะฒะบะฐ Kafka consumer (ัะตัะตะท context cancellation)
2. ะะฐะฒะตััะตะฝะธะต ะพะฑัะฐะฑะพัะบะธ ะฐะบัะธะฒะฝัั HTTP ะทะฐะฟัะพัะพะฒ (30s timeout)
3. ะะฐะบัััะธะต ัะพะตะดะธะฝะตะฝะธะน ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
4. ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ััะฐะฟะพะฒ

**ะะพะด:** `main.go:115-143`

### 3. Cache-Aside Pattern

ะะฐััะตัะฝ ะบััะธัะพะฒะฐะฝะธั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ:
1. ะัะพะฒะตัะบะฐ ะบััะฐ ะฟัะธ ะทะฐะฟัะพัะต
2. ะัะธ ะฟัะพะผะฐัะต - ะทะฐะณััะทะบะฐ ะธะท ะะ
3. ะกะพััะฐะฝะตะฝะธะต ัะตะทัะปััะฐัะฐ ะฒ ะบัั
4. ะะพะทะฒัะฐั ะดะฐะฝะฝัั ะบะปะธะตะฝัั

**ะะพะด:** `main.go:24-58`

### 4. ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั

ะะฝะพะณะพััะพะฒะฝะตะฒะฐั ะฒะฐะปะธะดะฐัะธั ะทะฐะบะฐะทะพะฒ:
- **ะกัััะบัััะฝะฐั** - ะบะพััะตะบัะฝะพััั JSON
- **ะขะธะฟะพะฒะฐั** - ัะพะพัะฒะตัััะฒะธะต ัะธะฟะพะฒ ะดะฐะฝะฝัั
- **ะะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ** - ะฟะพะปะพะถะธัะตะปัะฝัะต ััะผะผั, ะบะพััะตะบัะฝัะต email/phone ะธ ั.ะด.

ะะตะฒะฐะปะธะดะฝัะต ัะพะพะฑัะตะฝะธั ะปะพะณะธัััััั ะธ ะบะพะผะผะธััััั (ะฝะต ะฒัะทัะฒะฐัั ะฑะตัะบะพะฝะตัะฝัะต retry).

**ะะพะด:** `internal/validator/order_validator.go`

### 5. Repository Pattern

ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะธะฝัะตััะตะนัะพะฒ ะดะปั ะฐะฑัััะฐะบัะธะธ ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ:
- ะฃะฟัะพัะฐะตั ัะตััะธัะพะฒะฐะฝะธะต (ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั mock)
- ะะพะทะฒะพะปัะตั ะผะตะฝััั ัะตะฐะปะธะทะฐัะธั ะะ ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
- ะกะปะตะดัะตั ะฟัะธะฝัะธะฟะฐะผ SOLID (Dependency Inversion)

**ะะพะด:** `internal/interfaces/interfaces.go`, `internal/repository/database.go`

### 6. ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ Kafka

ะกััะฐัะตะณะธั ะพะฑัะฐะฑะพัะบะธ ัะพะพะฑัะตะฝะธะน:
- โ **Commit** - ััะฟะตัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะธ ัะพััะฐะฝะตะฝะธะต
- โ **Commit** - ะพัะธะฑะบะฐ ะฟะฐััะธะฝะณะฐ JSON (ะฝะตะฒะฐะปะธะดะฝัะน ัะพัะผะฐั)
- โ **Commit** - ะพัะธะฑะบะฐ ะฒะฐะปะธะดะฐัะธะธ (ะฝะตะฒะฐะปะธะดะฝัะต ะดะฐะฝะฝัะต)
- โ **No Commit** - ะพัะธะฑะบะฐ ะะ (ะฑัะดะตั retry)

**ะะพะด:** `kafka/consumer.go:60-111`

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะัั

- **ะัะตะผั ะดะพัััะฟะฐ:** O(1)
- **Throughput:** ~10,000 req/sec (ะฝะฐ ัะธะฟะธัะฝะพะผ ะถะตะปะตะทะต)
- **Memory usage:** ะะฐะฒะธัะธั ะพั CACHE_MAX_SIZE ะธ ัะฐะทะผะตัะฐ Order ะพะฑัะตะบัะพะฒ
- **Hit rate:** 90%+ ะดะปั ะฟะพะฒัะพััััะธััั ะทะฐะฟัะพัะพะฒ

### ะะฐะทะฐ ะดะฐะฝะฝัั

- **ะะฝะดะตะบัั:** ะฝะฐ `order_uid` ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ
- **Connection pooling:** ัะฟัะฐะฒะปัะตััั GORM
- **Preload:** ะทะฐะณััะทะบะฐ ัะฒัะทะฐะฝะฝัั ัััะฝะพััะตะน ะพะดะฝะธะผ ะทะฐะฟัะพัะพะผ
- **Transactions:** ะดะปั ะบะพะฝัะธััะตะฝัะฝะพััะธ ะดะฐะฝะฝัั

### HTTP Server

- **Framework:** Gin (ะฒััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝัะน ัะพััะตั)
- **JSON ัะตัะธะฐะปะธะทะฐัะธั:** ััะฐะฝะดะฐััะฝัะน `encoding/json`
- **Keep-alive:** ะฟะพะดะดะตัะถะบะฐ persistent connections
- **Concurrency:** ะณะพัััะธะฝั ะดะปั ะบะฐะถะดะพะณะพ ะทะฐะฟัะพัะฐ

## ๐ข ะะฐะทะฒะตัััะฒะฐะฝะธะต

### Docker (ัะตะบะพะผะตะฝะดัะตััั)

1. **ะกะฑะพัะบะฐ Docker ะพะฑัะฐะทะฐ:**

```bash
docker build -t wb-service:latest .
```

2. **ะะฐะฟััะบ ั docker-compose:**

```bash
docker-compose up -d
```

### Production

**ะะตะบะพะผะตะฝะดะฐัะธะธ ะดะปั production:**

1. **ะัะฟะพะปัะทัะนัะต ะฒะฝะตัะฝะธะต ัะตัะฒะธัั:**
   - Managed PostgreSQL (AWS RDS, Google Cloud SQL)
   - Managed Kafka (Confluent Cloud, AWS MSK)

2. **ะะฐัััะพะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:**
   ```bash
   export DB_HOST=production-db.example.com
   export DB_PORT=5432
   export KAFKA_BROKERS=kafka1.prod:9092,kafka2.prod:9092
   export CACHE_MAX_SIZE=10000
   export CACHE_TTL=3600
   ```

3. **ะะฐัััะพะนัะต reverse proxy:**
   - nginx ะธะปะธ Traefik ะดะปั SSL termination
   - Rate limiting
   - Request buffering

4. **ะะบะปััะธัะต SSL/TLS:**
   - PostgreSQL: `DB_SSL_MODE=require`
   - Kafka: ะฝะฐัััะพะนัะต SSL/SASL ะฐััะตะฝัะธัะธะบะฐัะธั

5. **ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ:**
   - Prometheus ะผะตััะธะบะธ
   - Grafana ะดะฐัะฑะพัะดั
   - Alertmanager ะดะปั ะฐะปะตััะพะฒ
   - ELK/Loki ะดะปั ะปะพะณะพะฒ

6. **Horizontal scaling:**
   - ะะฐะฟัััะธัะต ะฝะตัะบะพะปัะบะพ ะธะฝััะฐะฝัะพะฒ ัะตัะฒะธัะฐ
   - Load balancer ะฟะตัะตะด HTTP ัะตัะฒะตัะฐะผะธ
   - Kafka consumer group ะดะปั ัะฐัะฟัะตะดะตะปะตะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ

7. **ะะตะทะพะฟะฐัะฝะพััั:**
   - ะัะฟะพะปัะทัะนัะต secrets management (Vault, AWS Secrets Manager)
   - ะะฐัััะพะนัะต network policies
   - ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต ะทะฐะฒะธัะธะผะพััะธ
   - ะกะบะฐะฝะธััะนัะต Docker ะพะฑัะฐะทั ะฝะฐ ััะทะฒะธะผะพััะธ

### Kubernetes

**ะัะธะผะตั deployment.yaml:**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wb-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: wb-service
  template:
    metadata:
      labels:
        app: wb-service
    spec:
      containers:
      - name: wb-service
        image: wb-service:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: host
        - name: KAFKA_BROKERS
          value: "kafka.default.svc.cluster.local:9092"
        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```
